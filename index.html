<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>cXc Pangea Integration</title>
  <!-- Updated for GitHub Pages deployment -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700&display=swap">
  <link rel="stylesheet" href="./cxc-world-main.css">
  <link rel="stylesheet" href="./cxc-world-responsive.css">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <header>
    <div class="brand">
      <span class="logo">cXc</span>
      <span class="subtitle">Pangea Passport</span>
    </div>
    <div class="auth-controls">
      <select id="networkSelect">
        <option value="pangea">Pangea (Tonomy)</option>
        <option value="eos">EOS Mainnet</option>
        <option value="jungle">Jungle</option>
        <option value="custom">Custom</option>
      </select>
      <input id="customRpc" class="hidden" placeholder="Custom RPC" />
      <input id="customChainId" class="hidden" placeholder="Custom Chain ID" />
    </div>
    <button id="connectBtn" class="btn primary">Connect with Tonomy</button>
  </header>

  <section class="card" id="qrCard" style="display: none;">
    <h2>Connect via QR</h2>
    <p>Scan with the Tonomy mobile wallet to connect this session.</p>
    <div class="grid">
      <div class="qr-panel">
        <div id="tonomyQr" class="qr-box"></div>
      </div>
    </div>
    <div id="tonomyQrStatus" class="hint"></div>
  </section>

  <main>
    <section class="card">
      <h2>Onboarding</h2>
      <p>Resume the guided flow: welcome -> create account -> invite code -> verification -> tutorial.</p>
      <div id="onboardingList" class="step-list"></div>
      <div class="actions">
        <button id="onboardingNext" class="btn primary">Next step</button>
        <button id="onboardingReset" class="btn secondary">Restart</button>
        <span id="onboardingStatus" class="hint"></span>
      </div>
    </section>

    <section class="card two-column">
      <div>
        <h2>Invite Friends</h2>
        <p>Share your username to earn tetrahedral BLUX rewards.</p>
        <label>Inviter Code</label>
        <input id="inviteCode" placeholder="alice.cxc">
        <label>Invite New User</label>
        <input id="inviteTarget" placeholder="bob.cxc">
        <button id="sendInvite" class="btn primary">Send Invite</button>
        <div id="inviteResult" class="hint"></div>
      </div>
      <div>
        <h3>Your Stats</h3>
        <div id="stats" class="stat-grid">
          <div><span>Direct</span><strong>0</strong></div>
          <div><span>Network</span><strong>0</strong></div>
          <div><span>Rewards</span><strong>0 BLUX</strong></div>
        </div>
      </div>
    </section>

    <section class="card two-column">
      <div>
        <h2>Passport & Daily Upvotes</h2>
        <p>Claim daily upvotes based on your Passport verification level.</p>
        <div class="pill" id="passportBadge">Passport level 0</div>
        <div id="passportHint" class="hint">Connect with Tonomy to load your level.</div>
        <button id="claimUpvotes" class="btn primary">Claim Daily Upvotes</button>
        <div id="upvoteStatus" class="hint"></div>
      </div>
      <div>
        <h3>Allocation</h3>
        <div id="upvoteMeter" class="meter">
          <div class="fill" style="width: 0%"></div>
        </div>
        <div id="upvoteCounts" class="hint">0 / 0 upvotes</div>
        <div id="upvoteReset" class="hint">Reset time not loaded</div>
      </div>
    </section>

    <section class="card">
      <h2>Referral Dashboard</h2>
      <p>Track downstream invites and invite status.</p>
      <div id="referralTotals" class="hint">Connect to load referrals.</div>
      <div id="referralList" class="list-box">-</div>
    </section>

    <section class="card">
      <h2>Bridge BLUX: WAX -> Tonomy</h2>
      <div id="bridgeStepper" class="stepper">
        <div class="step" data-step="memo"><div class="badge">1</div><div>Generate memo</div></div>
        <div class="step" data-step="lock"><div class="badge">2</div><div>Lock on WAX</div></div>
        <div class="step" data-step="mint"><div class="badge">3</div><div>Mint on Tonomy</div></div>
      </div>
      <div class="grid">
        <div>
          <label>Amount (BLUX)</label>
          <input id="bridgeAmount" type="number" min="1" step="0.0001" placeholder="100.0000">
        </div>
        <div>
          <label>Tonomy Account</label>
          <input id="tonomyAccount" placeholder="alice.cxc">
        </div>
        <div>
          <label>WAX Account</label>
          <input id="waxAccount" placeholder="alice.wam">
        </div>
        <div>
          <label>Bridge Memo</label>
          <input id="bridgeMemo" placeholder="TRANSFER_..." readonly>
        </div>
      </div>
      <button id="bridgeBtn" class="btn primary">Bridge Tokens</button>
      <button id="bridgeCheckBtn" class="btn secondary">Check Bridge Status</button>
      <div class="hint">
        Explorer: <a id="bridgeExplorerWax" class="hidden" target="_blank" rel="noreferrer">WAX tx</a>
        <a id="bridgeExplorerTonomy" class="hidden" target="_blank" rel="noreferrer">Tonomy tx</a>
      </div>
      <div id="bridgeStatus" class="hint"></div>
    </section>
  </main>

  <!-- eosjs globals for browser usage -->
  <script src="https://cdn.jsdelivr.net/npm/eosjs@22.1.0/dist/eosjs-jsonrpc.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/eosjs@22.1.0/dist/eosjs-jssig.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/eosjs@22.1.0/dist/eosjs-api.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <!-- Tonomy ID SDK global for browser usage -->
  <script type="module">
    let pkg;
    try {
      pkg = await import("https://cdn.jsdelivr.net/npm/@tonomy/tonomy-id-sdk@1.0.0/+esm");
    } catch (e) {
      try {
        pkg = await import("https://unpkg.com/@tonomy/tonomy-id-sdk@1.0.0?module");
      } catch (e2) {
        try {
          pkg = await import("https://cdn.skypack.dev/@tonomy/tonomy-id-sdk@1.0.0");
        } catch (e3) {
          pkg = await import("https://esm.sh/@tonomy/tonomy-id-sdk@1.0.0?bundle&exports=createTonomyId");
        }
      }
    }
    window.createTonomyId = pkg.createTonomyId || pkg.default?.createTonomyId || pkg.default || pkg;
  </script>
  <script type="module" src="./app.js"></script>
</body>
</html>
